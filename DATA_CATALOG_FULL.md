# Data Catalog

Auto-generated by `scripts/describe_data.py`.

## Executive Snapshot

- SQL tables discovered: **4**

## Data Creation Pipeline

Derived from `crawler/` and `scripts/` code paths.

### Discover WKO branches

- Code: `crawler/branch_catalog.py`
- Inputs: `https://firmen.wko.at/branchen.aspx`
- Outputs: `data/wko_branch_catalog.json`
- Notes: Crawls A-Z branch index, deduplicates branch/url pairs, stores crawl metadata.

### Rate branch crawl priority

- Code: `crawler/branch_rating.py`
- Inputs: `data/wko_branch_catalog.json, data/crawl_state.json (if exists)`
- Outputs: `data/wko_branch_ratings.json`
- Notes: Scores branches by keyword relevance, freshness, historical yield, and denied-access penalty.

### Continuously crawl WKO companies

- Code: `crawler/continuous_crawler.py`
- Inputs: `data/wko_branch_catalog.json, data/wko_branch_ratings.json, WKO website pages`
- Outputs: `data/out/companies_continuous.jsonl, data/crawl_state.json, data/out/companies_dedupe.sqlite`
- Notes: Uses adaptive loop + load-more paging, local SQLite dedupe, optional Supabase upsert to wko_companies.

### Crawl EVI bilanz publications

- Code: `crawler/evi_bilanz.py`
- Inputs: `https://www.evi.gv.at/s?suche=Bilanz`
- Outputs: `data/out/evi_bilanz.jsonl`
- Notes: Crawls paginated search results, extracts publication metadata and company fields.

### Create DB schema for WKO

- Code: `scripts/setup_wko_schema.sql`
- Inputs: `Supabase/Postgres`
- Outputs: `public.wko_companies, public.wko_branches`
- Notes: Creates tables, unique constraints, and trigram/text indexes.

### Import WKO to DB

- Code: `scripts/import_wko_companies.py`
- Inputs: `data/out/companies_continuous.jsonl (default candidate), data/wko_branch_catalog.json (optional branch import)`
- Outputs: `public.wko_companies, public.wko_branches`
- Notes: Normalizes fields, computes wko_key hash, upserts to Supabase with conflict handling.

### Create DB schema for EVI

- Code: `scripts/setup_evi_schema.sql`
- Inputs: `Supabase/Postgres`
- Outputs: `public.evi_bilanz_publications`
- Notes: Creates table plus unique and search indexes.

### Import EVI to DB

- Code: `scripts/import_evi_bilanz.py`
- Inputs: `data/out/evi_bilanz.jsonl (default candidate)`
- Outputs: `public.evi_bilanz_publications`
- Notes: Parses publication_date, builds evi_key hash, upserts by evi_key.

### Create DB schema for projectfacts

- Code: `scripts/setup_projectfacts_schema.sql`
- Inputs: `Supabase/Postgres`
- Outputs: `public.projectfacts`
- Notes: Creates table with normalized/search columns and trigram indexes.

### Import projectfacts to DB

- Code: `scripts/import_projectfacts.py`
- Inputs: `data/projectfacts.xlsx or data/out/projectfacts.xlsx`
- Outputs: `public.projectfacts`
- Notes: Maps German column names, normalizes text, computes pf_key hash, upserts into Supabase.

## SQL Schemas

Scanned schema files:
- `scripts/setup_evi_schema.sql`
- `scripts/setup_projectfacts_schema.sql`
- `scripts/setup_wko_schema.sql`

Detected tables: **4**

### `evi_bilanz_publications`

- Source schema: `scripts/setup_evi_schema.sql`
- Columns: 16
- Indexes: 6

| Column | Definition |
|---|---|
| `id` | `uuid primary key default gen_random_uuid()` |
| `evi_key` | `text unique not null` |
| `publication_date` | `date` |
| `publication_type` | `text` |
| `detail_url` | `text` |
| `source_item_path` | `text` |
| `source_search_url` | `text` |
| `company_name` | `text` |
| `company_name_norm` | `text` |
| `firmenbuchnummer` | `text` |
| `search_text` | `text` |
| `crawled_at` | `timestamptz` |
| `imported_at` | `timestamptz default now()` |
| `raw_row` | `jsonb` |
| `created_at` | `timestamptz default now()` |
| `updated_at` | `timestamptz default now()` |

Indexes:
- `UNIQUE INDEX evi_bilanz_publications_evi_key_uq ON evi_bilanz_publications (evi_key)`
- `UNIQUE INDEX evi_bilanz_publications_detail_url_uq ON evi_bilanz_publications (detail_url)`
- `INDEX evi_bilanz_publications_date_idx ON evi_bilanz_publications (publication_date desc)`
- `INDEX evi_bilanz_publications_fb_idx ON evi_bilanz_publications (firmenbuchnummer)`
- `INDEX evi_bilanz_publications_company_trgm ON evi_bilanz_publications using gin (company_name gin_trgm_ops)`
- `INDEX evi_bilanz_publications_search_text_trgm ON evi_bilanz_publications using gin (search_text gin_trgm_ops)`

### `projectfacts`

- Source schema: `scripts/setup_projectfacts_schema.sql`
- Columns: 23
- Indexes: 5

| Column | Definition |
|---|---|
| `id` | `uuid primary key default gen_random_uuid()` |
| `pf_key` | `text unique not null` |
| `name` | `text` |
| `ort` | `text` |
| `name_norm` | `text` |
| `street` | `text` |
| `plz` | `text` |
| `city` | `text` |
| `city_norm` | `text` |
| `state` | `text` |
| `country` | `text` |
| `segment_country` | `text` |
| `industries` | `text` |
| `size` | `text` |
| `last_changed_at` | `timestamptz` |
| `last_activity_at` | `timestamptz` |
| `company_address` | `text` |
| `raw_addresses` | `text` |
| `address_norm` | `text` |
| `search_text` | `text` |
| `raw_row` | `jsonb` |
| `created_at` | `timestamptz default now()` |
| `updated_at` | `timestamptz default now()` |

Indexes:
- `UNIQUE INDEX projectfacts_pf_key_uq ON projectfacts (pf_key)`
- `INDEX pf_name_trgm ON projectfacts using gin (name gin_trgm_ops)`
- `INDEX pf_address_trgm ON projectfacts using gin (company_address gin_trgm_ops)`
- `INDEX pf_city_trgm ON projectfacts using gin (city gin_trgm_ops)`
- `INDEX pf_search_text_trgm ON projectfacts using gin (search_text gin_trgm_ops)`

### `wko_branches`

- Source schema: `scripts/setup_wko_schema.sql`
- Columns: 8
- Table constraints: 1
- Indexes: 2

| Column | Definition |
|---|---|
| `id` | `uuid primary key default gen_random_uuid()` |
| `branche` | `text not null` |
| `branch_url` | `text not null` |
| `letter` | `text` |
| `source` | `text` |
| `discovered_at` | `timestamptz` |
| `created_at` | `timestamptz default now()` |
| `updated_at` | `timestamptz default now()` |

Constraints:
- `unique (branche, branch_url)`

Indexes:
- `UNIQUE INDEX wko_branches_branche_url_uq ON wko_branches (branche, branch_url)`
- `INDEX wko_branches_letter_idx ON wko_branches (letter)`

### `wko_companies`

- Source schema: `scripts/setup_wko_schema.sql`
- Columns: 18
- Indexes: 7

| Column | Definition |
|---|---|
| `id` | `uuid primary key default gen_random_uuid()` |
| `wko_key` | `text unique not null` |
| `branche` | `text` |
| `name` | `text` |
| `wko_detail_url` | `text` |
| `company_website` | `text` |
| `email` | `text` |
| `phone` | `text` |
| `street` | `text` |
| `zip_city` | `text` |
| `address` | `text` |
| `source_list_url` | `text` |
| `crawled_at` | `timestamptz` |
| `imported_at` | `timestamptz default now()` |
| `search_text` | `text` |
| `raw_row` | `jsonb` |
| `created_at` | `timestamptz default now()` |
| `updated_at` | `timestamptz default now()` |

Indexes:
- `UNIQUE INDEX wko_companies_wko_key_uq ON wko_companies (wko_key)`
- `INDEX wko_companies_detail_url_idx ON wko_companies (wko_detail_url)`
- `INDEX wko_companies_branche_idx ON wko_companies (branche)`
- `INDEX wko_companies_crawled_at_idx ON wko_companies (crawled_at)`
- `INDEX wko_name_trgm ON wko_companies using gin (name gin_trgm_ops)`
- `INDEX wko_address_trgm ON wko_companies using gin (address gin_trgm_ops)`
- `INDEX wko_search_text_trgm ON wko_companies using gin (search_text gin_trgm_ops)`
